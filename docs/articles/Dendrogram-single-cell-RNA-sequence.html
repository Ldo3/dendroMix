<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dendrogram-single-cell-RNA-sequence â€¢ dendroMix</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Dendrogram-single-cell-RNA-sequence">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dendroMix</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1-10</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Ldo3/dendroMix">
    <span class="fa fa-github"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Dendrogram-single-cell-RNA-sequence</h1>
                        <h4 data-toc-skip class="author">Linh Do, Dat
Do</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Ldo3/dendroMix/blob/HEAD/vignettes/Dendrogram-single-cell-RNA-sequence.Rmd"><code>vignettes/Dendrogram-single-cell-RNA-sequence.Rmd</code></a></small>
      <div class="hidden name"><code>Dendrogram-single-cell-RNA-sequence.Rmd</code></div>

    </div>

    
    
<p>We consider an application of the dendrogram of mixing measures in
Single-cell RNA-sequencing data presented in Grace XY Zheng et al
(2017), where they collected 68,000 peripheral blood mononuclear cells
and labelled them based on expression profiles of 11 reference
transcriptomes from known cell types. There are five cell types in the
dataset: memory T cells, B cells, naive T cells, natural killer cells,
and monocytes. After cleaning the data (dropping low-count cells and
performing log pseudo-count transform), there are 41,159 cells left. The
result of this experiment is reported in our paper Section 5.4.</p>
<p>We project the unlabeled data onto the first 10 Principal Component
(PC) spaces and fit with a mixture of location-scale Gaussians with 15
components. We then visualize the 15-atom mixing measure with the
dendrogram constructed.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Ldo3.github.io/dendroMix" class="external-link">dendroMix</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mclust-org.github.io/mclust/" class="external-link">mclust</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://mvtnorm.R-forge.R-project.org" class="external-link">mvtnorm</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/HenrikBengtsson/matrixStats" class="external-link">matrixStats</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"tcell_id"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"bcell_id"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"mono_id"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"nk_id"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"naive_id"</span><span class="op">)</span></span>
<span><span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_sce_processed.html">load_sce_processed</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initialize color_list if not yet created (replace N with total number of cells)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">10000</span>  <span class="co"># replace this with your actual length</span></span>
<span><span class="va">color_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA_integer_</span>, <span class="va">N</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Flatten and adjust inDSCes (-1 because Python is 0-based)</span></span>
<span><span class="va">tcell_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">tcell_id</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="va">bcell_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">bcell_id</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="va">mono_id</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">mono_id</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="va">nk_id</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">nk_id</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="va">naive_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">naive_id</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># Assign colors</span></span>
<span><span class="va">color_list</span><span class="op">[</span><span class="va">tcell_id</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>  <span class="co"># +1 since R is 1-based</span></span>
<span><span class="va">color_list</span><span class="op">[</span><span class="va">bcell_id</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">color_list</span><span class="op">[</span><span class="va">mono_id</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span>  <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">color_list</span><span class="op">[</span><span class="va">nk_id</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span>    <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">color_list</span><span class="op">[</span><span class="va">naive_id</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">4</span></span></code></pre></div>
<p>Visualizing the data after applying PCA with 10 components.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># --- Prepare matrix: make rows = cells ---</span></span>
<span><span class="va">sce_mat</span> <span class="op">&lt;-</span> <span class="va">sce</span><span class="op">$</span><span class="va">x</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sce_mat</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># --- Figure out whether IDs are 0- or 1-based, then make a cell_type vector ---</span></span>
<span><span class="va">all_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tcell_id</span>, <span class="va">bcell_id</span>, <span class="va">mono_id</span>, <span class="va">nk_id</span>, <span class="va">naive_id</span><span class="op">)</span></span>
<span><span class="co"># Heuristic: if max ID equals N-1, it's 0-based; if equals N, it's 1-based</span></span>
<span><span class="va">offset</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">all_ids</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">==</span> <span class="va">N</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="fl">1L</span> <span class="kw">else</span> <span class="fl">0L</span></span>
<span></span>
<span><span class="va">cell_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Other/Unknown"</span>, <span class="va">N</span><span class="op">)</span></span>
<span></span>
<span><span class="va">set_label</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id_vec</span>, <span class="va">label</span><span class="op">)</span> <span class="op">{</span></span>
<span>     <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">id_vec</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">id_vec</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">offset</span></span>
<span>     <span class="va">idx</span> <span class="op">&lt;-</span> <span class="va">idx</span><span class="op">[</span><span class="va">idx</span> <span class="op">&gt;=</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">idx</span> <span class="op">&lt;=</span> <span class="va">N</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">idx</span><span class="op">)</span><span class="op">]</span></span>
<span>     <span class="va">cell_type</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span> <span class="op">&lt;&lt;-</span> <span class="va">label</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">set_label</span><span class="op">(</span><span class="va">tcell_id</span>,  <span class="st">"T cell"</span><span class="op">)</span></span>
<span><span class="fu">set_label</span><span class="op">(</span><span class="va">bcell_id</span>,  <span class="st">"B cell"</span><span class="op">)</span></span>
<span><span class="fu">set_label</span><span class="op">(</span><span class="va">mono_id</span>,   <span class="st">"Monocyte"</span><span class="op">)</span></span>
<span><span class="fu">set_label</span><span class="op">(</span><span class="va">nk_id</span>,     <span class="st">"NK cell"</span><span class="op">)</span></span>
<span><span class="fu">set_label</span><span class="op">(</span><span class="va">naive_id</span>,  <span class="st">"Naive"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cell_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">cell_type</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"T cell"</span>,<span class="st">"B cell"</span>,<span class="st">"Monocyte"</span>,<span class="st">"NK cell"</span>,<span class="st">"Naive"</span>,<span class="st">"Other/Unknown"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># --- Grab first two of the processed PCA for plotting ---</span></span>
<span><span class="va">pc2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">sce</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pc2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PC1"</span>,<span class="st">"PC2"</span><span class="op">)</span></span>
<span><span class="va">pc2</span><span class="op">$</span><span class="va">cell_type</span> <span class="op">&lt;-</span> <span class="va">cell_type</span></span>
<span></span>
<span><span class="co">#Extract the transformed data</span></span>
<span><span class="va">lowdim_data</span> <span class="op">&lt;-</span> <span class="va">sce</span><span class="op">$</span><span class="va">x</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">lowdim_data</span><span class="op">)</span>  </span></code></pre></div>
<pre><code><span><span class="co">## [1] 41159    10</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute explained variance ratio</span></span>
<span><span class="va">explained_var</span> <span class="op">&lt;-</span> <span class="va">sce</span><span class="op">$</span><span class="va">sdev</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sce</span><span class="op">$</span><span class="va">sdev</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">df_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  PC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">explained_var</span><span class="op">)</span>,</span>
<span>  Cumulative <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">explained_var</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot cumulative explained variance</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_var</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PC</span>, y <span class="op">=</span> <span class="va">Cumulative</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># geom_point(color = "steelblue") +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.9</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"PCA Explained Variance (10 components)"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Number of Components"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Cumulative Explained Variance"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Dendrogram-single-cell-RNA-sequence_files/figure-html/pca%20plot-1.png" alt="Visualization" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pc2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">PC1</span>, <span class="va">PC2</span>, color <span class="op">=</span> <span class="va">cell_type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.7</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Cells in PC space (colored by type)"</span>, x <span class="op">=</span> <span class="st">"PC1"</span>, y <span class="op">=</span> <span class="st">"PC2"</span>, color <span class="op">=</span> <span class="st">"Cell type"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Dendrogram-single-cell-RNA-sequence_files/figure-html/pca%20plot-2.png" alt="Visualization" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">K_bar</span> <span class="op">&lt;-</span> <span class="fl">15</span></span>
<span></span>
<span><span class="co"># Fit Gaussian Mixture Model (full covariance by default)</span></span>
<span><span class="va">gmm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mclust-org.github.io/mclust/reference/Mclust.html" class="external-link">Mclust</a></span><span class="op">(</span><span class="va">lowdim_data</span>, G <span class="op">=</span> <span class="va">K_bar</span>, modelNames <span class="op">=</span> <span class="st">"VVV"</span><span class="op">)</span>  <span class="co"># "VVV" = variable volume, shape, orientation</span></span>
<span></span>
<span><span class="co"># View results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">gmm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ---------------------------------------------------- </span></span>
<span><span class="co">## Gaussian finite mixture model fitted by EM algorithm </span></span>
<span><span class="co">## ---------------------------------------------------- </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Mclust VVV (ellipsoidal, varying volume, shape, and orientation) model with 15</span></span>
<span><span class="co">## components: </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  log-likelihood     n  df      BIC      ICL</span></span>
<span><span class="co">##       -723669.3 41159 989 -1457847 -1473330</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Clustering table:</span></span>
<span><span class="co">##    1    2    3    4    5    6    7    8    9   10   11   12   13   14   15 </span></span>
<span><span class="co">##  774 4922 2348 2465 8110 4182  209  872 4240 5149 1907 2056 1172  459 2294</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Means of each component (columns = features)</span></span>
<span>  <span class="va">mus_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">gmm</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">mean</span><span class="op">)</span>     </span>
<span>  </span>
<span>  <span class="co"># Mixing weights</span></span>
<span>  <span class="va">p_hat</span> <span class="op">&lt;-</span> <span class="va">gmm</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">pro</span>         </span>
<span>  </span>
<span>  <span class="co"># Covariance matrices </span></span>
<span>  <span class="va">sigmas_hat</span> <span class="op">=</span> <span class="va">gmm</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">variance</span><span class="op">$</span><span class="va">sigma</span></span>
<span>  <span class="va">Sigma_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">sigmas_hat</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">k</span><span class="op">)</span> <span class="va">sigmas_hat</span><span class="op">[</span>,,<span class="va">k</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">dmm</span> <span class="op">=</span> <span class="fu"><a href="../reference/dendrogram_mixing.html">dendrogram_mixing</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">p_hat</span>,</span>
<span>                          thetas <span class="op">=</span> <span class="va">mus_hat</span>,</span>
<span>                          sigmas <span class="op">=</span> <span class="va">Sigma_list</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1</span></span>
<span><span class="co">## [1] 10 10</span></span>
<span><span class="co">##         PC1         PC2         PC3         PC4         PC5         PC6 </span></span>
<span><span class="co">##  0.70140369 -0.14607666  0.09853746 -0.05634262  0.27698288 -1.08928752 </span></span>
<span><span class="co">##         PC7         PC8         PC9        PC10 </span></span>
<span><span class="co">##  0.85779874  0.03394440  0.03452121  0.08187661 </span></span>
<span><span class="co">## [1] 2</span></span>
<span><span class="co">## [1] 10 10</span></span>
<span><span class="co">##          PC1          PC2          PC3          PC4          PC5          PC6 </span></span>
<span><span class="co">## -0.125535491  0.080952362  0.122496899  0.142030740  0.025149652 -0.005272748 </span></span>
<span><span class="co">##          PC7          PC8          PC9         PC10 </span></span>
<span><span class="co">##  0.268890843 -0.103245493  0.104779561 -0.022923640 </span></span>
<span><span class="co">## [1] 3</span></span>
<span><span class="co">## [1] 10 10</span></span>
<span><span class="co">##          PC1          PC2          PC3          PC4          PC5          PC6 </span></span>
<span><span class="co">## -0.369931084  0.118800956  0.180662612 -0.121787218  0.808559562 -0.228803758 </span></span>
<span><span class="co">##          PC7          PC8          PC9         PC10 </span></span>
<span><span class="co">## -0.069300560 -0.262129874 -0.145504279  0.002771599 </span></span>
<span><span class="co">## [1] 4</span></span>
<span><span class="co">## [1] 10 10</span></span>
<span><span class="co">##        PC1        PC2        PC3        PC4        PC5        PC6        PC7 </span></span>
<span><span class="co">## -0.2461284 -2.6237085  1.3741872 -4.5538355  0.4716232  1.8364461  1.3179853 </span></span>
<span><span class="co">##        PC8        PC9       PC10 </span></span>
<span><span class="co">## -1.1876928 -0.3117930 -0.2117590 </span></span>
<span><span class="co">## [1] 5</span></span>
<span><span class="co">## [1] 10 10</span></span>
<span><span class="co">##         PC1         PC2         PC3         PC4         PC5         PC6 </span></span>
<span><span class="co">## -0.15131537  0.24727353 -0.06636070  0.06207173 -0.40105019  0.37303571 </span></span>
<span><span class="co">##         PC7         PC8         PC9        PC10 </span></span>
<span><span class="co">## -0.13104168 -0.39219383  0.32111687  0.24115411 </span></span>
<span><span class="co">## [1] 6</span></span>
<span><span class="co">## [1] 10 10</span></span>
<span><span class="co">##         PC1         PC2         PC3         PC4         PC5         PC6 </span></span>
<span><span class="co">##  0.21268303 -0.83919794 -0.28527233 -1.24636806  0.73730198 -1.23590784 </span></span>
<span><span class="co">##         PC7         PC8         PC9        PC10 </span></span>
<span><span class="co">## -0.78845401  0.81655852 -0.48035437 -0.09645562 </span></span>
<span><span class="co">## [1] 7</span></span>
<span><span class="co">## [1] 10 10</span></span>
<span><span class="co">##          PC1          PC2          PC3          PC4          PC5          PC6 </span></span>
<span><span class="co">##  0.991548962  0.056550757  0.007057403 -0.410301788 -0.482189638 -0.161668615 </span></span>
<span><span class="co">##          PC7          PC8          PC9         PC10 </span></span>
<span><span class="co">## -0.098401432  0.478196512  0.061795734  0.282569857 </span></span>
<span><span class="co">## [1] 8</span></span>
<span><span class="co">## [1] 10 10</span></span>
<span><span class="co">##          PC1          PC2          PC3          PC4          PC5          PC6 </span></span>
<span><span class="co">##  0.004874373  0.220121931  0.395827265  0.732118339  0.113585645 -0.397889462 </span></span>
<span><span class="co">##          PC7          PC8          PC9         PC10 </span></span>
<span><span class="co">##  1.813045714  0.177860927 -0.114281211 -0.031262553 </span></span>
<span><span class="co">## [1] 9</span></span>
<span><span class="co">## [1] 10 10</span></span>
<span><span class="co">##         PC1         PC2         PC3         PC4         PC5         PC6 </span></span>
<span><span class="co">## -0.20104520 -0.21307937  0.18009811 -0.30138475  0.78404892 -0.35782132 </span></span>
<span><span class="co">##         PC7         PC8         PC9        PC10 </span></span>
<span><span class="co">## -0.24089348  0.08183946  0.10640232 -0.37370708 </span></span>
<span><span class="co">## [1] 10</span></span>
<span><span class="co">## [1] 10 10</span></span>
<span><span class="co">##         PC1         PC2         PC3         PC4         PC5         PC6 </span></span>
<span><span class="co">## -0.73218375  0.36732001  0.10015872  0.44140234  0.39715432  0.45698459 </span></span>
<span><span class="co">##         PC7         PC8         PC9        PC10 </span></span>
<span><span class="co">##  0.14000873 -0.11082143  0.00632919  0.02996172 </span></span>
<span><span class="co">## [1] 11</span></span>
<span><span class="co">## [1] 10 10</span></span>
<span><span class="co">##          PC1          PC2          PC3          PC4          PC5          PC6 </span></span>
<span><span class="co">##  1.353115855 -0.602387977  0.007462626  3.222246091 -0.384487053 -0.487174203 </span></span>
<span><span class="co">##          PC7          PC8          PC9         PC10 </span></span>
<span><span class="co">## -0.319062854  0.025730319 -0.015487979 -0.067647042 </span></span>
<span><span class="co">## [1] 12</span></span>
<span><span class="co">## [1] 10 10</span></span>
<span><span class="co">##          PC1          PC2          PC3          PC4          PC5          PC6 </span></span>
<span><span class="co">##  0.918486845  3.542754848  2.694648955  0.042008098 -0.129833590 -0.086357087 </span></span>
<span><span class="co">##          PC7          PC8          PC9         PC10 </span></span>
<span><span class="co">## -0.151334913 -0.008796524  0.005867716 -0.027877091 </span></span>
<span><span class="co">## [1] 13</span></span>
<span><span class="co">## [1] 10 10</span></span>
<span><span class="co">##          PC1          PC2          PC3          PC4          PC5          PC6 </span></span>
<span><span class="co">## -1.219236114 -5.032031068  4.443892817 -0.177842786 -0.436871431  0.103106441 </span></span>
<span><span class="co">##          PC7          PC8          PC9         PC10 </span></span>
<span><span class="co">## -0.043198182  0.006954177 -0.047594265 -0.002109692</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">main_title</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Dendrogram in the first PC"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/plot_dendrogram_mixing.html">plot_dendrogram_mixing</a></span><span class="op">(</span><span class="va">dmm</span>, dim <span class="op">=</span> <span class="fl">1</span>,point_size <span class="op">=</span> <span class="fl">1</span>, main<span class="op">=</span><span class="va">main_title</span><span class="op">)</span></span></code></pre></div>
<p><img src="Dendrogram-single-cell-RNA-sequence_files/figure-html/dendrogram%20and%20plots-1.png" alt="Dendrogram of the first two dimensions" width="700"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">main_title</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Dendrogram in the second PC"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/plot_dendrogram_mixing.html">plot_dendrogram_mixing</a></span><span class="op">(</span><span class="va">dmm</span>, dim <span class="op">=</span> <span class="fl">2</span>,point_size <span class="op">=</span> <span class="fl">1</span>, main<span class="op">=</span><span class="va">main_title</span><span class="op">)</span></span></code></pre></div>
<p><img src="Dendrogram-single-cell-RNA-sequence_files/figure-html/dendrogram%20and%20plots-2.png" alt="Dendrogram of the first two dimensions" width="700"></p>
<div class="section level2">
<h2 id="dendrogram-selection-criterion">Dendrogram Selection Criterion<a class="anchor" aria-label="anchor" href="#dendrogram-selection-criterion"></a>
</h2>
<p>We provide an example of using the Dendrogram Selection Criterion
(DSC) in selecting model from the constructed dendrogram.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loglikelihood_GMM</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span>, <span class="va">pi</span>, <span class="va">mu</span>, <span class="va">Sigma</span><span class="op">)</span> <span class="op">{</span></span>
<span>     <span class="co"># X: n x d numeric matrix</span></span>
<span>     <span class="co"># pi: length-k numeric vector (mixing weights)</span></span>
<span>     <span class="co"># mu: k x d numeric matrix (means; rows = components)</span></span>
<span>     <span class="co"># Sigma: a list of length k with d x d matrices, or a 3D array d x d x k</span></span>
<span>     </span>
<span>     <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span>     <span class="va">k</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pi</span><span class="op">)</span></span>
<span>     <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span>     <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span>     </span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span> <span class="op">==</span> <span class="va">d</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span> <span class="op">==</span> <span class="va">k</span><span class="op">)</span></span>
<span>     </span>
<span>     <span class="va">getSigma</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">j</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">is.list</a></span><span class="op">(</span><span class="va">Sigma</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>               <span class="va">Sigma</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span></span>
<span>          <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>               <span class="va">Sigma</span><span class="op">[</span>,,<span class="va">j</span><span class="op">]</span></span>
<span>          <span class="op">}</span></span>
<span>     <span class="op">}</span></span>
<span>     </span>
<span>     <span class="co"># log p(x_i | comp j) + log pi_j, computed for ALL i at once per j</span></span>
<span>     <span class="va">log_pi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">pi</span><span class="op">)</span></span>
<span>     <span class="va">logdens_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span></span>
<span>          X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span>,</span>
<span>          FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">j</span><span class="op">)</span> <span class="fu">mvtnorm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mvtnorm/man/Mvnorm.html" class="external-link">dmvnorm</a></span><span class="op">(</span><span class="va">X</span>, mean <span class="op">=</span> <span class="va">mu</span><span class="op">[</span><span class="va">j</span>, <span class="op">]</span>, sigma <span class="op">=</span> <span class="fu">getSigma</span><span class="op">(</span><span class="va">j</span><span class="op">)</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="va">log_pi</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>,</span>
<span>          FUN.VALUE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>     <span class="op">)</span></span>
<span>     <span class="co"># log-sum-exp per row</span></span>
<span>     <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">matrixStats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/matrixStats/man/rowRanges.html" class="external-link">rowMaxs</a></span><span class="op">(</span><span class="va">logdens_mat</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">m</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">logdens_mat</span> <span class="op">-</span> <span class="va">m</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">llh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">K_bar</span><span class="op">)</span></span>
<span><span class="va">K_list</span> <span class="op">&lt;-</span> <span class="va">K_bar</span><span class="op">:</span><span class="fl">1</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">K_bar</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>     <span class="va">pi_i</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">dmm</span><span class="op">$</span><span class="va">Gs</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">ps</span><span class="op">)</span></span>
<span>     <span class="va">mu_i</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">dmm</span><span class="op">$</span><span class="va">Gs</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">thetas</span><span class="op">)</span>     <span class="co"># ensure k x d (rows = components)</span></span>
<span>     <span class="va">Sigma_i</span> <span class="op">&lt;-</span> <span class="va">dmm</span><span class="op">$</span><span class="va">Gs</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sigmas</span>                <span class="co"># list or 3D array is fine</span></span>
<span>     </span>
<span>     <span class="co"># If your thetas are d x k, flip them:</span></span>
<span>     <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mu_i</span><span class="op">)</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pi_i</span><span class="op">)</span><span class="op">)</span> <span class="va">mu_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">mu_i</span><span class="op">)</span></span>
<span>     </span>
<span>     <span class="va">llh</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">loglikelihood_GMM</span><span class="op">(</span><span class="va">lowdim_data</span>, <span class="va">pi_i</span>, <span class="va">mu_i</span>, <span class="va">Sigma_i</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># d_list = (dmm$hc$height)</span></span>
<span><span class="va">d_list</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">dmm</span><span class="op">$</span><span class="va">hc</span><span class="op">$</span><span class="va">height</span><span class="op">)</span></span>
<span><span class="co">## --- Compute DSC</span></span>
<span><span class="va">rescale_d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">d_list</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">d_list</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">lowdim_data</span><span class="op">)</span></span>
<span><span class="va">DSC</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="op">(</span><span class="va">rescale_d</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">llh</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="va">n</span><span class="op">)</span> <span class="op">*</span> <span class="va">llh</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">llh</span><span class="op">)</span><span class="op">]</span> <span class="op">/</span> <span class="va">n</span><span class="op">)</span>  </span>
<span><span class="va">DSC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">DSC</span><span class="op">)</span></span>
<span></span>
<span><span class="va">choice_k_DSC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="va">DSC</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span></span>
<span></span>
<span><span class="co">## --- Panel A: DSC curve ---</span></span>
<span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  k <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">15</span>,</span>
<span>  DSC <span class="op">=</span> <span class="va">DSC</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">k</span>, <span class="va">DSC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.8</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>, size <span class="op">=</span> <span class="fl">3</span>, fill <span class="op">=</span> <span class="st">"blue"</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">choice_k_DSC</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"deepskyblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="va">choice_k_DSC</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">df1</span><span class="op">$</span><span class="va">DSC</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>           label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"DSC finds "</span>, <span class="va">choice_k_DSC</span>, <span class="st">" components"</span><span class="op">)</span>,</span>
<span>           vjust <span class="op">=</span> <span class="fl">0.1</span>, hjust <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"deepskyblue"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">df1</span><span class="op">$</span><span class="va">k</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">16</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Number of components"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Selection Criterion"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">" DSC scores"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title.position <span class="op">=</span> <span class="st">"plot"</span>,</span>
<span>        plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span>b <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, vjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## --- Panel B: Heights between levels in dendrogram ---</span></span>
<span><span class="va">d_rev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">d_list</span><span class="op">)</span>                     </span>
<span><span class="va">k_vals</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">d_rev</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>          </span>
<span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  k <span class="op">=</span> <span class="va">k_vals</span>,</span>
<span>  height <span class="op">=</span> <span class="va">d_rev</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">k</span>, <span class="va">height</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">k_vals</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Number of components"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Height of dendrogram"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Height at levels in dendrogram"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title.position <span class="op">=</span> <span class="st">"plot"</span>,</span>
<span>        plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span>b <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, vjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">|</span> <span class="va">p2</span></span></code></pre></div>
<p><img src="Dendrogram-single-cell-RNA-sequence_files/figure-html/DSC-1.png" alt="DSC" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Linh Do, Dat Do.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
